Private Function BuildBulletsFromHyphens(ByVal s As String) As String
    Dim parts As Variant, p As Variant, outText As String
    Dim cleaned As String

    ' Clean line breaks and double spaces
    cleaned = Replace(s, vbCrLf, " ")
    cleaned = Replace(cleaned, vbCr, " ")
    cleaned = Replace(cleaned, vbLf, " ")
    cleaned = Trim$(cleaned)

    ' ✅ Split only on a hyphen followed by a space ("- ")
    parts = Split(cleaned, "- ")

    ' Loop through each part — only use as bullet if it’s a full new item
    For Each p In parts
        If Len(Trim$(p)) > 0 Then
            ' Skip leading fragments that come before the first "- "
            If Left$(cleaned, 2) <> "- " And InStr(cleaned, "- ") = 0 Then
                ' no bullets if there were no "- " separators at all
                outText = cleaned
                Exit For
            Else
                outText = outText & Trim$(p) & vbCrLf
            End If
        End If
    Next p

    BuildBulletsFromHyphens = Trim$(outText)
End Function

' === Step: Apply formatting to "Key Management" section ===
Dim keyShape As Object
Set keyShape = sld.Shapes("txt_KeyManagement")

' Base formatting for entire text (reset first)
With keyShape.TextFrame.TextRange.Font
    .Name = "Arial"
    .Size = 10
    .Bold = False
    .Color.RGB = RGB(0, 0, 0) ' black by default
End With

' === Detect and format date tokens ===
Set regex = CreateObject("VBScript.RegExp")
With regex
    .Global = True
    .IgnoreCase = False
    .Pattern = "(\b\d{1,2}\s[A-Za-z]{3}\s\d{4}:)"
End With

Set tr = keyShape.TextFrame.TextRange
Set matches = regex.Execute(tr.Text)

If matches.Count > 0 Then
    ' Grab color of first character (your PPT blue)
    Dim dateColor As Long
    dateColor = tr.Characters(1, 1).Font.Color.RGB

    Dim dateText As String, startPos As Long, dateLen As Long, afterLen As Long
    For Each m In matches
        ' Convert date to uppercase
        dateText = UCase$(m.Value)
        startPos = m.FirstIndex + 1
        dateLen = Len(dateText)

        ' Replace original text with uppercase date
        tr.Characters(startPos, Len(m.Value)).Text = dateText

        ' Format the date part: blue + bold
        With tr.Characters(startPos, dateLen).Font
            .Bold = True
            .Name = "Arial"
            .Size = 10
            .Color.RGB = dateColor
        End With

        ' Format text after the colon (till next bullet or line break)
        afterLen = 0
        Do While startPos + dateLen + afterLen <= tr.Length
            If Mid(tr.Text, startPos + dateLen + afterLen, 1) = vbCr Then Exit Do
            afterLen = afterLen + 1
        Loop
        If afterLen > 0 Then
            With tr.Characters(startPos + dateLen, afterLen).Font
                .Bold = False
                .Name = "Arial"
                .Size = 10
                .Color.RGB = RGB(0, 0, 0) ' ensure black
            End With
        End If
    Next m
End If


-----------------------------------------------------------------------------------------------------------

Private Function BuildOwnershipBullets(ByVal s As String) As String
    Dim tmp As String, lines As Variant, ln As Variant
    Dim nameStr As String, titleStr As String, outText As String
    Dim parts As Variant

    ' === Step 1: Clean unwanted characters ===
    s = Trim$(s)

    ' Remove leading/trailing single quotes if present
    If Left$(s, 1) = "'" Then s = Mid$(s, 2)
    If Right$(s, 1) = "'" Then s = Left$(s, Len(s) - 1)

    ' Replace double quotes, normalize line breaks
    s = Replace(s, """", "")
    s = Replace(s, vbCrLf, vbLf)
    s = Replace(s, vbCr, vbLf)

    ' === Step 2: Split by lines (each one is a bullet) ===
    lines = Split(s, vbLf)

    ' === Step 3: Loop through lines and reformat ===
    For Each ln In lines
        ln = Trim$(ln)
        If Len(ln) = 0 Then GoTo NextLine

        ' Remove starting dash (- or –) if present
        If Left$(ln, 1) = "-" Or Left$(ln, 1) = "–" Then
            ln = Trim$(Mid$(ln, 2))
        End If

        ' Split on first dash/en-dash between name and title
        If InStr(ln, "–") > 0 Then
            parts = Split(ln, "–", 2)
        ElseIf InStr(ln, "-") > 0 Then
            parts = Split(ln, "-", 2)
        Else
            parts = Array(ln, "")
        End If

        nameStr = Trim$(parts(0))
        titleStr = ""
        If UBound(parts) > 0 Then titleStr = Trim$(parts(1))

        ' Reverse order: Designation first, then Name
        If Len(titleStr) > 0 Then
            outText = outText & titleStr & ": " & nameStr & vbCrLf
        Else
            outText = outText & nameStr & vbCrLf
        End If

NextLine:
    Next ln

    BuildOwnershipBullets = Trim$(outText)
End Function

